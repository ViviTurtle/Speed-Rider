DROP DATABASE IF EXISTS speeqhyw_Speed_Rider;
CREATE DATABASE speeqhyw_Speed_Rider;
USE speeqhyw_Speed_Rider; 

DROP TABLE IF EXISTS T_CODES;
CREATE TABLE T_CODES(
		CODE_ID CHAR(5) NOT NULL,
        CODE_TYPE VARCHAR(10) NOT NULL,
		CODE_DESCRIPTION VARCHAR(255) NOT NULL,
		CREATED_BY INT,
		CREATED_ON TIMESTAMP DEFAULT CURRENT_TIMESTAMP 
);

DROP TABLE IF EXISTS T_USER;
CREATE TABLE T_USER
(
        USER_ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
		USERNAME VARCHAR(32) NOT NULL,
		SALTED_HASH CHAR(64) NOT NULL,
		FNAME VARCHAR(32) NOT NULL,
		LNAME VARCHAR(32) NOT NULL,
		EMAIL VARCHAR(50) NOT NULL,
		PRIM_PHONE CHAR(10) NOT NULL,
		SEC_PHONE CHAR(10),
		USER_TYPE CHAR(5) NOT NULL REFERENCES T_CODES(CODE_ID),
		STATUS_TYPE CHAR(5) NOT NULL REFERENCES T_CODES(CODE_ID),
		CURRENT_LONGITUDE DECIMAL(9,5),
		CURRENT_LATITUDE DECIMAL(9,5)
);

DROP TABLE IF EXISTS T_TRANSANCTION;
CREATE TABLE T_TRANSANCTION
(
		TRANS_ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
		CLIENT_USERNAME VARCHAR(32) NOT NULL REFERENCES T_USER(USER_ID),
		DRIVER_USERNAME VARCHAR(32)  NOT NULL REFERENCES T_USER(USER_ID),
		PICK_UP_LONGITUDE DECIMAL(9,5) NOT NULL,
		PICK_UP_LATITUDE DECIMAL(9,5) NOT NULL,
		DROP_OFF_LONGITUDE DECIMAL(9,5),
		DROP_OFF_LATITUDE DECIMAL(9,5), 
		INIT_DRIVER_LONGITUDE DECIMAL(9,5) NOT NULL,
		INIT_DRIVER_LATITUDE DECIMAL(9,5) NOT NULL,
		COST DECIMAL(65,2),
		STATUS CHAR(5) NOT NULL REFERENCES T_CODES(CODE_ID),
		CREATED_ON TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
		UPDATED_ON TIMESTAMP
);

ALTER TABLE T_CODES ADD CONSTRAINT FK_USER_TYPE FOREIGN KEY (CREATED_BY) REFERENCES T_USER(USER_ID);

DROP VIEW IF EXISTS V_GET_CLIENTS;
CREATE VIEW V_GET_CLIENTS AS 
SELECT *
FROM T_USER
WHERE USER_TYPE = 'CLIET';

DROP VIEW IF EXISTS V_GET_DRIVERS;
CREATE VIEW V_GET_DRIVERS AS 
SELECT *
FROM T_USER
WHERE USER_TYPE = 'DRIVR';


-- DEFAULT DATA BECAUSE LOAD DATA LOCAL INFILE COMMAND IS NOT WORKING

INSERT INTO `T_USER` VALUES 
  (1,'ViviTurtle','TESTING','Vivi','Langga','vivi.langga@gmail.com','4086075657',NULL,'ADMIN','OFFLN',NULL,NULL)
, (2,'Client5','TESTING','Kat','Dennings','kdenningst@gmail.com','4086071234',NULL,'CLIET','LFDRV',-122.41390,37.64973)
, (3,'Driver1','TESTING','Driv1','Kent','superman@gmail.com','4086074321',NULL,'DRIVR','OFFLN',23.21352,212.12313)
, (4,'Driver2','TESTING','Driv2','Kent','superman@gmail.com','4086074321',NULL,'DRIVR','LFCLT',-121.84769,37.20422)
, (5,'Driver3','TESTING','Driv3','Kent','superman@gmail.com','4086074321',NULL,'DRIVR','LFCLT',-121.98267,37.36742)
, (6,'Driver4','TESTING','Driv4','Kent','superman@gmail.com','4086074321',NULL,'DRIVR','LFCLT',-121.88052,37.33413)
, (7,'Client6','TESTING','Nate','Dogg','ndogg@gmail.com','4082371534',NULL,'CLIET','LFDRV',-122.09607,37.60112)
, (8,'Client7','TESTING','Wanda','Sykes','wsykes@gmail.com','4088234455',NULL,'CLIET','LFDRV',-122.17431,37.42697)
, (9,'Client8','TESTING','Steve','Rogers','cptamerica@gmail.com','5123451234',NULL,'CLIET','LFDRV',-122.12186,37.34023)
, (10,'Client1','TESTING','Eamon','Forester','eforester@blah.com','952321423',NULL,'CLIET','LFDRV',-121.80869,37.23705)
, (11,'Client2','TESTING','Robin','Williams','rwilliams@lateandgreat.com','5129893245',NULL,'CLIET','LFDRV',-121.99664,37.26001)
, (12,'Client3','TESTING','Michael','Rotch','mikerotch@simpsons.com','5432149543',NULL,'CLIET','LFDRV',-121.96114,37.32034)
, (13,'Client4','TESTING','Mae','Day','mday@sos.com','51423456',NULL,'CLIET','LFDRV',-121.90647,37.42653)
, (14,'LinusT','TESTING','Linus','Torvalds','ltorvalds@os.com','9542341265',NULL,'CLIET','LFDRV',-121.99520,37.51664)
, (15,'bjarmst','TESTING','B.J.','Armstrong','barmstrong@blah.com','8184524231',NULL,'CLIET','LFDRV',-121.88320,37.66521)
, (16,'Driver6','TESTING','Kifta','John','batman2@gmail.com','4086074341',NULL,'DRIVR','LFCLT',-121.32020,37.56810)
, (17,'Driver7','TESTING','Tidus','Frank','aquaman3@gmail.com','4086074351',NULL,'DRIVR','LFCLT',-121.32560,37.55424)
, (18,'Driver8','TESTING','Yuna','Cloud','fastman4@gmail.com','4086074361',NULL,'DRIVR','LFCLT',-122.48892,37.75498)
, (19,'Driver9','TESTING','Lulu','Tifa','hyperman5@gmail.com','4086074371',NULL,'DRIVR','LFCLT',-122.44652,37.72783)
, (20,'Driver10','TESTING','Auron','Kent','slowman6@gmail.com','4086074381',NULL,'DRIVR','LFCLT',-122.42506,37.78198)
, (21,'Driver11','TESTING','Wakka','DooDoo','TheDude@gmail.com','4089112394',NULL,'DRIVR','LFCLT',-121.878523,37.941961)
, (22,'Driver12','TESTING','Squall','Crap','Sucks@gmail.com','4088222404',NULL,'DRIVR','LFCLT',-122.078409,37.986376)
, (23,'Driver13','TESTING','Aerith','Obama','Presient@us.gov','4081111111',NULL,'DRIVR','LFCLT',-122.256937,37.859363)
, (24,'Driver14','TESTING','Sephy','Choco','freakman1@gmail.com','4086074331',NULL,'DRIVR','LFCLT',-122.19276,37.33418)
, (25,'Driver15','TESTING','Jeht','Anastsia','danceman2@gmail.com','4086074341',NULL,'DRIVR','LFCLT',-121.32020,37.56810)
, (26,'Driver16','TESTING','Kat','Dragon','swimman3@gmail.com','4086074351',NULL,'DRIVR','LFCLT',-121.32560,37.55424)
, (27,'Driver14','TESTING','Lindsay','Lohan','trainwreck@gmail.com','69696969',NULL,'DRIVR','LFCLT',-121.873024,37.667815) 
, (28,'Driver15','TESTING','Hillary','Clinton','nonencrypted@emailserver.com','4088421234',NULL,'DRIVR','LFCLT',-122.098244,37.683033)
, (29,'Driver16','TESTING','Kate','Spade','purses@blah.gov','5104234231',NULL,'DRIVR','LFCLT',-121.921776,37.496952)
, (30,'Driver5','TESTING','Rinoa','Clark','superman1@gmail.com','4086074331',NULL,'DRIVR','LFCLT',-122.19276,37.33418);

INSERT INTO T_CODES VALUES ('ADMIN','USER','Adminstrative Users',1, CURRENT_TIMESTAMP);
INSERT INTO T_CODES VALUES ('DRIVR','USER','Drivers',1, CURRENT_TIMESTAMP);
INSERT INTO T_CODES VALUES ('CLIET','USER','Clients',1, CURRENT_TIMESTAMP);
INSERT INTO T_CODES VALUES ('COMPT','T_STATUS','Driver has been paid and Client has been dropped off',1, CURRENT_TIMESTAMP);
INSERT INTO T_CODES VALUES ('IPROG','T_STATUS','Transanction is in-progress',1, CURRENT_TIMESTAMP);
INSERT INTO T_CODES VALUES ('REFUN','T_STATUS','The transanction has been canceled',1, CURRENT_TIMESTAMP);
INSERT INTO T_CODES VALUES ('LFDRV','U_STATUS','Looking for Driver',1, CURRENT_TIMESTAMP);
INSERT INTO T_CODES VALUES ('LFCLT','U_STATUS','Looking for Client',1, CURRENT_TIMESTAMP);
INSERT INTO T_CODES VALUES ('OFFLN','U_STATUS','Offline',1, CURRENT_TIMESTAMP);
INSERT INTO T_CODES VALUES ('INROT','U_STATUS','Currently being on route',1, CURRENT_TIMESTAMP);



INSERT INTO T_TRANSANCTION (CLIENT_USERNAME, DRIVER_USERNAME, PICK_UP_LONGITUDE, PICK_UP_LATITUDE,INIT_DRIVER_LONGITUDE, INIT_DRIVER_LATITUDE, COST, STATUS)
	VALUES ('Client1','Driver1',23.23152, 23.23152, 23.23152, 23.23152, 23400.50, 'IPROG');

INSERT INTO T_TRANSANCTION (CLIENT_USERNAME, DRIVER_USERNAME, PICK_UP_LONGITUDE, PICK_UP_LATITUDE,INIT_DRIVER_LONGITUDE, INIT_DRIVER_LATITUDE, COST, STATUS)
	VALUES ('Client2','Driver2',23.23152,23.23152,23.23152,23.23152, 0, 'IPROG');

INSERT INTO T_TRANSANCTION (CLIENT_USERNAME, DRIVER_USERNAME, PICK_UP_LONGITUDE, PICK_UP_LATITUDE,INIT_DRIVER_LONGITUDE, INIT_DRIVER_LATITUDE, COST, STATUS)
	VALUES ('Client3','Driver3',23.23152, 23.23152, 23.23152, 23.23152, 240.50, 'IPROG');

UPDATE T_TRANSANCTION
	SET STATUS = 'COMPT', UPDATED_ON = CURRENT_TIMESTAMP
	WHERE TRANS_ID = 1;

UPDATE T_TRANSANCTION
	SET STATUS = 'REFUN', UPDATED_ON = CURRENT_TIMESTAMP
	WHERE TRANS_ID = 3;

